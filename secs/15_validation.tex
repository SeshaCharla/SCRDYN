\newpage
\section{Model Validation: Simulation Results}

The full switched nonlinear model is simulated with the initial conditions alone and the inputs ($u_1, u_2, F$ and $T$). The switching condition is not currently clear but assuming the goal of controller is to maximize the performance of the catalyst, the guard condition for switching to the saturated model is chosen to be the maximum $NO_x$ reduction among the saturated and desaturated models that is closed to the inlet $NO_x$. The state diagram for the system presented in the figure~\ref{fig::hybrid_automata}.

\begin{figure}[H]
        \centering
        \includegraphics[width=0.75\textwidth]{\froot/figs/15_figs/hybrid_model.png}
        \caption{State diagram describing the SCR-ASC system}
        \label{fig::hybrid_automata}
\end{figure}

We have the equations describing the switched nonlinear dynamics:
\begin{itemize}
\item De-saturated Catalyst Model:
\begin{align*}
        \text{Flow Condition (Dynamics):} &\\
                \eta(k+1) &= \eta(k) \lrb{\frac{u_1(k)}{F(k)}} \lrb{\frac{F(k-1)}{u_1(k-1)}}
                    - \pmb \phi^T_{\eta}(k) \pmb \theta_{\eta}  + \pmb \phi_{\Gamma}^T(k) \pmb \theta_{\Gamma}
                    \\
        \text{Invariance Conditions:} & \\
                0 &\leq \eta (k+1) \leq u_1(k)\\
                T &\in \lrb{T_{min}, T_{max}}\\
                F &\geq F_{min}\\
                u_1 &\geq u_{1_{min}}
\end{align*}
\item Saturated Catalyst Model:
\begin{align*}
        \text{Flow Condition (Dynamics):} & \\
                \eta_{sat}(k+1) &= \lrb{\frac{u_1(k)}{F(k)}} \pmb \phi^T(k) \pmb \theta_{\Gamma scr}\\
        \text{Invariance Conditions:} & \\
                0 &\leq \eta_{sat} (k+1) \leq u_1(k)\\
                T &\in \lrb{T_{min}, T_{max}}\\
                F &\geq F_{min}\\
                u_1 &\geq u_{1_{min}}
\end{align*}

\item The guard conditions for switching are still a work in progress. For the present work, the conditions is based on the objective of the closed-loop urea-dosing control system, i.e., maximizing $NO_x$ reduction at every time-step.
\begin{align*}
        \text{Saturated, if:} & \abs{u_1(k-1) - \eta_{sat}(k)} \leq \abs{u_1(k-1) - \eta(k)} \\
        \text{Desaturated, if:} & \abs{u_1(k-1) - \eta(k)} \leq \abs{u_1(k-1) - \eta_{sat}(k)}
\end{align*}
\end{itemize}


\input{\froot/secs/15_subs/results.tex}
