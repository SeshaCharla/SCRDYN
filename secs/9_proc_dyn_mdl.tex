\newpage
\section{Linear Parameter Model for SCR Process Dynamics with Urea Dosing \label{sec::proc_dyn}}
From previous derivations, we have the complete process dynamics of SCR-ASC dynamics with urea dosing as:

\begin{enumerate}
    \item Urea dosing dynamics:
    \begin{align*}
    \con{NH_3}^{in} (k) &= 2r_u V \times \frac{u_{inj}(k)}{f_v^2}
    \end{align*}

    \item $NO_x$ reduction dynamics:
    \begin{align*}
    \con{NO_x}^{out} (k + 1) &= \con{NO_x}^{in} (k) \lr{1 - k_{s2v} k_{scr} \sigma(k) \tau}
    \end{align*}

    \item Gaseous ammonia dynamics:
    \begin{align*}
    \con{NH_3}^{out} (k + 1) &= \con{NH_3}^{in}(k) \lr{1 - \tau k_{s2v}k_{ads} \lr{\Gamma - \sigma(k)}} + \tau k_{s2v} k_{des} \sigma(k)
    \end{align*}

    \item Ammonia adsorption/desorption dynamics:
 \begin{align*}
        \sigma(k + 1) &= \sigma(k)
        + n\tau k_{ads} \con{NH_3}^{in} \lr{\Gamma - \sigma(k)}
        - n \tau \lr{k_{oxi} + k_{des}} \sigma(k)
        - n \tau k_{scr} \con{NO_x}^{in}(k) \sigma(k)
    \end{align*}
\end{enumerate}

The above four equations are the complete process dynamics of SCR-ASC dynamics with urea dosing. The above equations are
nonlinear and coupled with implicit dependence on temperature and flow rate. In this section the above equations are
rewritten in a parametric form with standard state-space representation. For convenience and clarity '(k)' is dropped
from the variables.


Further, the models that have reciprocals and expoenetials of inputs are linearized about the operating points. These include:
\begin{enumerate}
    \item Rate constants
        \begin{align}
            k_i &= m_i T + c_i
        \end{align}
    \item Residence time (\ref{eqn::res_time})
        \begin{align}
            \tau &= \tau_0 - \tau_T T - \tau_F F
        \end{align}
\end{enumerate}

The following states and inputs are defined for the system:

\begin{align*}
    x_1 &= \con{NO_x}^{out} & u_1 &= \con{NO_x}^{in} \\
    x_2 &= \con{NH_3}^{out} & u_2 &= u_{inj} \\
    x_3 &= \sigma & u_3 &= T\\
        &         & u_4 &= F
\end{align*}

Thus, linear-parameter representation of each of the processes are as follows:
%%======================================================================================================================
\input{secs/9_subs/urea_dosing.tex}
\input{secs/9_subs/general_simplification.tex}
\input{secs/9_subs/nox_proc.tex}
\input{secs/9_subs/nh3_gas.tex}
\input{secs/9_subs/nh3_ads.tex}
%%======================================================================================================================

\subsection{Remarks on parameter estimation}
Thus, we have the linear parameter form of the model:
\begin{align*}
    x_1(k+1) &= u_1 + \pmb \phi_1^T  \pmb \theta_1 x_3 \\
    x_2(k+1) &= \pmb \phi_2 ^T \Psi_2 \pmb \theta_2 \\
    x_3(k+1) &= x_3 + \pmb \phi_3^T \theta_3
\end{align*}

Since, we don't have any $x_3$ measurements, one way to get a model that fits the data is by assuming $x_3$ is varying slowly and then estimate the slowly varying parameters and then fit the adsorption dynamics to the slowly varying dynamics of the parameters to estimate the constant parameter of the adsorption dynamics. These slowly varying parameter are the product of a constant to the adsorbed ammonia. Let,
\begin{align*}
    \beta_i &= x_3 \theta_i
\end{align*}
Thus we have the slowly varying parameter dynamics:
\begin{align*}
    \beta_i(k+1) &= \beta_i + \pmb \phi_{3, \beta}^T \theta_{3, \beta}
\end{align*}
Where,
\begin{align*}
    \pmb \phi_{3, \beta}^T &= \bm{\pmb \phi_{\tau, ur} &
                                -\beta_3 \pmb \phi_{\tau, ur} &
                                -\beta_3 \pmb \phi_\tau  &
                                -\beta_3 u_1 \pmb \phi_{\tau}} \\
    \pmb \theta_{3, \beta} &= \bm{n \theta_i \Gamma \pmb \theta_{ads, ur} \\
                             n \pmb \theta_{ads, ur}    \\
                             n \pmb \theta_{od}         \\
                             n \pmb \theta_{scr}}
\end{align*}
